---
layout: blog-post.liquid
title: Easy dynamic social sharing image with eleventy
date: 2023-01-23
permalink: "blog/{{ title | slugify }}/index.html"
tags:
  - post
  - programming
---

## Introduction

I'm in the process of rebuilding this website using [eleventy](https://www.11ty.dev/) and I wanted to get fancy with this revamped site.

One feature I wanted was a custom Open Graph social share image for each page on the site. If you're not familiar with Open Graph, check out [this explanation](https://www.freecodecamp.org/news/what-is-open-graph-and-how-can-i-use-it-for-my-website/). In a nutshell, when you share links to the site on social networks, it should an image to draw people into the page.

Eleventy has a pretty robust ecosystem already and lo and behold, there are already plugins to handle this for you. Great, let's just check them out.

## What's out there?

[eleventy-plugin-social-img](https://github.com/tannerdolby/eleventy-plugin-social-img#readme) pre-generates cards using a shortcode. I spent about 30 minutes trying to grok the readme and how to use the plugin. I like that you could create an HTML template, but the plugin looked overly complicated for what I needed.

[@resoc/eleventy-plugin-social-image](https://github.com/Resocio/eleventy-plugin-social-image#readme) only works with Netlify and requires a server component. This site is hosted on GitHub Pages and is fully static. Pass.

[eleventy-plugin-social-share-card-generator](https://github.com/tpiros/eleventy-plugin-social-share-card-generator#readme) requires a Cloudinary account. Pass.

[eleventy-plugin-og-image](https://github.com/KiwiKilian/eleventy-plugin-og-image#readme) looks promising, pre-generates images, and looks pretty easy to use. This could be a runner-up if I ever want to go a different route.

All in all, I wasn't a huge fan of these solutions. There had to be something simpler.

## Something simpler

The eleventy team offers various [API Services](https://www.11ty.dev/docs/api-services/) for the public to use. [Screenshots](https://www.11ty.dev/docs/services/screenshots/) is a runtime service that takes a screenshot of a URL and returns that image (and caches it). Bingo!

All I need to do is create a simple template and style it however I'd like for my social sharing card. Apply the template to every page in the site. Then the service can generate screenshots for my blog posts on demand when somebody shares a link to my site.

## Creating the card template

To make it easy to manipulate URLs, I would have a mirrored set of paths at `https://patricklee.nyc/social/<page URL>`. Then I simply embed that URL to the screenshot service API URL and it would return an image.

Example of the social card webpage:

[https://patricklee.nyc/social/about](https://patricklee.nyc/social/about])

Example of the social card screenshot image generated by the service:

[https://v1.screenshot.11ty.dev/https%3A%2F%2Fpatricklee.nyc%2Fsocial%2Fabout%2F/opengraph/\_1674507886315](https://v1.screenshot.11ty.dev/https%3A%2F%2Fpatricklee.nyc%2Fsocial%2Fabout%2F/opengraph/_1674507886315)

_Note: You need to URLEncodeURI the page being passed into the API_

I created the simplest webpage possible, you can see the template [here](https://github.com/patleeman/patricklee.nyc/blob/master/_includes/social.liquid).

- I wanted a simple design with the title of the page, the URL of this site, and a picture of me.
- I created a 1200 x 630 pixel box, then added my card contents in there. The [screenshot service](https://www.11ty.dev/docs/services/screenshots/#usage) accepts a size parameter `opengraph` which will take a 1200 x 630 pixel screenshot.

## Generating the pages

Next, we need to generate the pages on the build. To do this. I created a page `social.md` with some basic frontmatter. See the page [here](https://github.com/patleeman/patricklee.nyc/blob/master/social.md?plain=1).

```
---
layout: social.liquid
pagination:
  data: collections.all
  size: 1
  alias: post
permalink: "social/{{ post.url }}/"
---

```

This page uses a combination of [`collections.all`](https://www.11ty.dev/docs/collections/#the-special-all-collection), `pagination`, and `permalink` to force eleventy to generate a page for every page on the site under the `/social/{{ post.url }}` namespace.

Now when we want the social image for any page we simply add `/social/` to the URL.

For example, the page `https://patricklee.nyc/about` has a social image at `https://patricklee.nyc/social/about`.

## Updating the Open Graph tags

The last part is to update the Open Graph tags to use this image. In my header, I had my Open Graph social tags available. I just needed to create a URL that would take each page's URL, and append `/social` to it, then embed it into the screenshot service's URL scheme.

To make things dead simple, I just [created a shortcode](https://github.com/patleeman/patricklee.nyc/blob/56e675dd7d94121337a91924dc72eec5bbfab084/.eleventy.js#L51-L57) that would generate this URL when used on a page.

```js
// eleventy.js
eleventyConfig.addShortcode("openGraphScreenshotURL", function () {
  // URL Encode the page
  const encodedURL = encodeURIComponent(
    `https://patricklee.nyc/social${this.page.url}`
  );
  // Generate a cache-busting key for quicker testing
  const cacheKey = `_${new Date().valueOf()}`;
  // Return the screenshot service's URL to add to the open graph tags.
  return `https://v1.screenshot.11ty.dev/${encodedURL}/opengraph/${cacheKey}`;
});
```

Then I updated my header to use this shortcode under the `og:image` and `twitter:image` tags [like so](https://github.com/patleeman/patricklee.nyc/blob/56e675dd7d94121337a91924dc72eec5bbfab084/_includes/layouts/header.liquid#L13).

```html
<!-- header.liquid -->
<meta property="og:image" content="{% openGraphScreenshotURL %}" />
<meta property="twitter:image" content="{% openGraphScreenshotURL %}" />
```

That's all it takes!

## Conclusion

The risk here is if the eleventy team decides to sunset the screenshot API, I'll need to switch to a solution that pre-generates the social share images or host the API myself. Considering how little traffic this site gets, I'll take that risk for reduced complexity now.

I like this solution ~~because I came up with it~~ because it is simpler, doesn't require pre-generating all the images upfront, and doesn't require adding more packages. Oh and because I was able to offload a lot of the work to the wonderful devs at eleventy. Thanks, ya'll!
